<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta name="description" content="Spatial data generator developed at UC Riverside by Puloma Katiyar under guidance of Dr. Ahmed Eldawy">
	<meta name="keywords" content="Spatial data, data generator, UCR, UC Riverside, UCR big data lab, test data, Puloma Katiyar, Ahmed Eldawy, computer science">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link rel="shortcut icon" href="sd.ico">
	<script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.3.1/build/ol.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.3.1/css/ol.css">
	<style type="text/css">
		.headcol { vertical-align: top; text-align: right; }
		.widgettab { vertical-align: top; text-align: left; }
		.bigtab { } 
		.pagehead { text-align: center; }
		.optionlabel1 { text-align: right; width: 35%; }
		.optiondata1 { width: 15%; }
		.optionlabel2 { text-align: right; width: 15%; }
		.optiondata2 { width: 35%; }
		.hide { position:absolute; top:-1px; left:-1px; width:1px; height:1px; }
		.inputError { color: red; font-size: 15px; }
		.transformfields { text-align: right; }
		#dataContent { width: 70%; height: 300px; }
	</style>

	<title>Spatial Data Generator</title>
	
	<script>
		var fEnableObj = {
			"perc": "diagonal",
			"buf": "diagonal",
			"prob": "bit",
			"dig": "bit",
			"sran": "parcel",
			"dith": "parcel",
			"dim": "uniform"
		}
		
		function disableInputs() {
			var distType = document.getElementById("dist").value
			if(fEnableObj.perc != distType)
				document.getElementById("per").disabled = true;
			if(fEnableObj.buf != distType)
				document.getElementById("buf").disabled = true;
			if(fEnableObj.prob != distType)
				document.getElementById("prob").disabled = true;
			if(fEnableObj.dig != distType)
				document.getElementById("dig").disabled = true;
			if(fEnableObj.sran != distType)
				document.getElementById("sran").disabled = true;
			if(fEnableObj.dith != distType)
				document.getElementById("dith").disabled = true;
			if(fEnableObj.dim != distType)
				document.getElementById("dim").disabled = true;				
		}
		
		function updateInputs() {
			document.getElementById("dim").value = 2;
			document.getElementById("dim").disabled = false;
			document.getElementById("per").disabled = false;
			document.getElementById("buf").disabled = false;
			document.getElementById("prob").disabled = false;
			document.getElementById("dig").disabled = false;
			document.getElementById("sran").disabled = false;
			document.getElementById("dith").disabled = false;	
			disableInputs();
		}
		
		function validInputs() {
			var valid = true;
			var val = document.getElementById("card").value
			if(val < 0 || val > 1000000000000) { // arbitrarily set max to 1 trillion
				document.getElementById("cardInputError").innerHTML = "Valid val > 0 and < 1 trillion";
				valid = false;
			}
			val = document.getElementById("dim").value
			if(document.getElementById("dist").value == "uniform") {
				if(val < 1 || val > 1000000) { // arbitrarily set max to 1 million
					document.getElementById("dimInputError").innerHTML = "Valid val > 1 and < 1 million";
					valid = false;
				}
			} else {
				if(val != 2) { 
					document.getElementById("dimInputError").innerHTML = "Valid val = 2";
					valid = false;
				}
			}
			val = document.getElementById("per").value
			if(val < 0 || val > 1) {
				document.getElementById("perInputError").innerHTML = "Valid val > 0 and < 1";
				valid = false;
			}
			val = document.getElementById("buf").value
			if(val < 0 || val > 1) {
				document.getElementById("bufInputError").innerHTML = "Valid val > 0 and < 1";
				valid = false;
			}
			val = document.getElementById("prob").value
			if(val < 0 || val > 1) {
				document.getElementById("probInputError").innerHTML = "Valid val > 0 and < 1";
				valid = false;
			}
			val = document.getElementById("dig").value
			if(val < 0 || val > 100000) {
				document.getElementById("digInputError").innerHTML = "Valid val >= 0 and < 100,000";
				valid = false;
			}				
			val = document.getElementById("sran").value
			if(val < 0 || val > 1) {
				document.getElementById("sranInputError").innerHTML = "Valid val > 0 and < 1";
				valid = false;
			}					
			val = document.getElementById("dith").value
			if(val < 0 || val > 1) {
				document.getElementById("dithInputError").innerHTML = "Valid val > 0 and < 1";
				valid = false;
			}
			val = document.getElementById("seed").value
			if(val && (val < 0 || val > 100000000000000)) { // arbitrarily set max to 100 trillion
				document.getElementById("seedInputError").innerHTML = "Valid val >= 0 and < 1 trillion";
				valid = false;
			}						
			return valid;
		}
		
		function resetInputError(inputId) {
			document.getElementById(inputId).innerHTML = "";
		}
		
		function buildURL(forRender, forPlink) {
			var paramVals = {
				"card": document.getElementById("card").value,
				"dist": document.getElementById("dist").value,
				"dim": document.getElementById("dim").value,
				"fmt": document.getElementById("fmt").value,
				"geo": "point",
				"seed": document.getElementById("seed").value
			};
			
			var inputVal = document.getElementById("per").value;
			if(!document.getElementById("per").disabled && inputVal)
				paramVals["per"] = inputVal;
			inputVal = document.getElementById("buf").value;
			if(!document.getElementById("buf").disabled && inputVal)
				paramVals["buf"] = inputVal;		
			inputVal = document.getElementById("prob").value;
			if(!document.getElementById("prob").disabled && inputVal)
				paramVals["prob"] = inputVal;		
			inputVal = document.getElementById("dig").value;
			if(!document.getElementById("dig").disabled && inputVal)
				paramVals["dig"] = inputVal;		
			inputVal = document.getElementById("sran").value;
			if(!document.getElementById("sran").disabled && inputVal)
				paramVals["sran"] = inputVal;		
			inputVal = document.getElementById("dith").value;
			if(!document.getElementById("dith").disabled && inputVal)
				paramVals["dith"] = inputVal;	

			var inputVal1 = document.getElementById("a1").value;
			var inputVal2 = document.getElementById("a2").value;
			var inputVal3 = document.getElementById("a3").value;
			var inputVal4 = document.getElementById("a4").value;
			var inputVal5 = document.getElementById("a5").value;
			var inputVal6 = document.getElementById("a6").value;
			if(!inputVal1 || !inputVal2 || !inputVal3 || !inputVal4|| !inputVal5 || !inputVal6) {
				document.getElementById("transformMessage").innerHTML = "Fill all parameters for transformation.";
			} else {
				paramVals["a1"] = inputVal1;
				paramVals["a2"] = inputVal2;
				paramVals["a3"] = inputVal3;
				paramVals["a4"] = inputVal4;
				paramVals["a5"] = inputVal5;
				paramVals["a6"] = inputVal6;
			}
				
			if(forRender) {
				var message = "";
				if(paramVals["card"] > 1000) {
					paramVals["card"] = 1000;
					message += "Only up to 1000 points supported for visualization. Cardinality overridden.";
				}
				if(paramVals["dim"] > 2) {
					paramVals["dim"] = 2;
					if(message)
						message += "<br>";
					message += "Only 2D supported for visualization. Dimensions overridden.";
				}
				paramVals["fmt"] = "wkt";
				paramVals["strm"] = "browser";
				document.getElementById("renderMessage").innerHTML = message;
			} else {
				paramVals["strm"] = "cfile";
			}
			
			if(!paramVals["seed"]) {
				var d = new Date();
				paramVals["seed"] = d.getTime();
			}
			
			if(forPlink)
				var url = "http://localhost/datagenerator.html?";
			else
				var url = "http://localhost/cgi/generator.py?";
			for(var key in paramVals) {
				url += (key + "=" + encodeURIComponent(paramVals[key]) + "&");
			}						
			return url;																			
		}
		
		function submitAndDownload() {
			formURL = buildURL(false, false);
			document.getElementById("downloadError").src = formURL;
		}
		
		function submitAndRender(inputId) {
			if(inputId == "dist")
				updateInputs();
			else
				resetInputError(inputId);
			if(!validInputs())
				return;
			formURL = buildURL(true, false);
			permalink = buildURL(false, true);
			document.getElementById("plink").value = permalink;

			var XHR = new XMLHttpRequest();
			XHR.addEventListener( 'load', function(event) {
				if(XHR.status != 200) {
					document.getElementById("renderMessage").innerHTML = `Error ${XHR.status}: ${XHR.statusText}`;
					return;
				}
				document.getElementById("dataContent").innerHTML = "";
                var vectorLayer = new ol.layer.Vector({
                    source: new ol.source.Vector({
                        features: (new ol.format.WKT()).readFeatures(XHR.responseText)
                    })
                });
                
                var view = new ol.View({
                    center: [0.5, 0.5],
                    zoom: 25
                });
                
                var map = new ol.Map({
                    target: 'dataContent',
                    layers: [vectorLayer],
                    view: view
                });
			});
			XHR.addEventListener( 'error', function(event) {
				document.getElementById("renderMessage").innerHTML = `Error ${XHR.status}: ${XHR.statusText}`;
			});
			XHR.open( 'GET', formURL);
			XHR.send(null);
		}
		
		function setupSubmitAndRender() {
			var curURL = new URL(window.location);
			var paramString = new URLSearchParams(curURL.searchParams);
			if(paramString != "") {
				if(paramString.has("dist"))
					document.getElementById('dist').value = paramString.get("dist");
				if(paramString.has("card"))
					document.getElementById('card').value = paramString.get("card");
				if(paramString.has("dim"))
					document.getElementById('dim').value = paramString.get("dim");
				if(paramString.has("fmt"))
					document.getElementById('fmt').value = paramString.get("fmt");
				if(paramString.has("per"))
					document.getElementById('per').value = paramString.get("per");
				if(paramString.has("buf"))
					document.getElementById('buf').value = paramString.get("buf");
				if(paramString.has("prob"))
					document.getElementById('prob').value = paramString.get("prob");
				if(paramString.has("dig"))
					document.getElementById('dig').value = paramString.get("dig");
				if(paramString.has("sran"))
					document.getElementById('sran').value = paramString.get("sran");
				if(paramString.has("dith"))
					document.getElementById('dith').value = paramString.get("dith");
				if(paramString.has("seed"))
					document.getElementById('seed').value = paramString.get("seed");
				if(paramString.has("a1"))
					document.getElementById('a1').value = paramString.get("a1");	
				if(paramString.has("a2"))
					document.getElementById('a2').value = paramString.get("a2");
				if(paramString.has("a3"))
					document.getElementById('a3').value = paramString.get("a3");
				if(paramString.has("a4"))
					document.getElementById('a4').value = paramString.get("a4");
				if(paramString.has("a5"))
					document.getElementById('a5').value = paramString.get("a5");
				if(paramString.has("a6"))
					document.getElementById('a6').value = paramString.get("a6");									
			}
			submitAndRender('dist');
		}
		
	</script>

</head>

<body style="background-color:#FEFEFF;" onload="setupSubmitAndRender()">
	<h1 class="pagehead">Spatial Data Generator</h1>
	
	<form id="datareq" action="javascript:void(0);" onSubmit="submitAndDownload()">
		<table class="bigtab" border="0" cellspacing="10" width="98%">
			<tbody>
				<tr>
					<td class="optionlabel1">
						Distribution:
					</td>
					<td class="optiondata1">
						<select id="dist" name="dist" onchange="submitAndRender('dist')">
							<option value="uniform">Uniform</option>
							<option value="diagonal">Diagonal</option>
							<option value="gaussian">Gaussian</option>
							<option value="sierpinski">Sierpinski</option>
							<option value="bit">Bit</option>
							<option value="parcel">Parcel</option>
						</select>
					</td>
					<td class="optionlabel2">
						Cardinality:	
					</td>
					<td class="optiondata2">
						<input type="number" value="100" id="card" name="card" onchange="submitAndRender('cardInputError')"></input>
						<div class="inputError" id="cardInputError"></div>
					</td>
				</tr>
				
				<tr>
					<td class="optionlabel1">
						Dimension:
					</td>
					
					<td class="optiondata1">
						<input type="number" value="2" id="dim" name="dim" onchange="submitAndRender('dimInputError')"></input>
						<div class="inputError" id="dimInputError"></div>
					</td>					
					
					
					<td class="optionlabel2">
						Format:
					</td>
					<td class="optiondata2">
						<select id="fmt" name="fmt">
							<option value="wkt">wkt</option>
							<option value="csv">csv</option>
							<option value="gjson">geoJSON</option>
						</select>
					</td>
				</tr>
				
				<tr>
					<td class="optionlabel1">
						Percentage:
					</td>
					<td class="optiondata1">
						<input type="text" value="0.5" id="per" name="per" onchange="submitAndRender('perInputError')"></input>
						<div class="inputError" id="perInputError"></div>
					</td>
					<td class="optionlabel2">
						Buffer:
					</td>
					<td class="optiondata2">
						<input type="text" value="0.5" id="buf" name="buf" onchange="submitAndRender('bufInputError')"></input>
						<div class="inputError" id="bufInputError"></div>
					</td>
				</tr>
				
				<tr>
					<td class="optionlabel1">
						Probability:
					</td>
					<td class="optiondata1">
						<input type="text" value="0.5" id="prob" name="prob" onchange="submitAndRender('probInputError')"></input>
						<div class="inputError" id="probInputError"></div>
					</td>
					<td class="optionlabel2">
						Digits:
					</td>
					<td class="optiondata2">
						<input type="number" value="2" id="dig" name="dig" onchange="submitAndRender('digInputError')"></input>
						<div class="inputError" id="digInputError"></div>
					</td>
				</tr>
				
				<tr>
					<td class="optionlabel1">
						Split range:
					</td>
					<td class="optiondata1">
						<input type="text" value="0.5" id="sran" name="sran" onchange="submitAndRender('sranInputError')"></input>
						<div class="inputError" id="sranInputError"></div>
					</td>
					<td class="optionlabel2">
						Dither:
					</td>
					<td class="optiondata2">
						<input type="text" value="0.5" id="dith" name="dith" onchange="submitAndRender('dithInputError')"></input>
						<div class="inputError" id="dithInputError"></div>
					</td>
				</tr>
				
				<tr>
					<td class="optionlabel1">
						Seed value:
					</td>
					<td class="optiondata1">
						<input type="number" id="seed" name="seed" onchange="submitAndRender('seedInputError')"></input>
						<div class="inputError" id="seedInputError"></div>
					</td>
					
					<td class="optionlabel2">
						Permalink:
					</td>
					<td class="optiondata2">
						<input type="text" id="plink" name="plink" value="" readonly></input>
					</td>
				</tr>
				
				<tr>
					<td colspan="4" align="center">
						<input type="submit" value="Download"></input>
					</td>
				</tr>
				
			</tbody>
		</table>

		<div id="downloadErrorDiv" name="downloadErrorDiv"> <iframe id="downloadError" name="downloadError" class="hide"> </iframe> </div>
		<div id="renderMessage" name="renderMessage"> </div>
		
		<div id="dataContent" name="dataContent" align="left">
			Data should be rendered here.
			<iframe id="resultData" name="resultData" class="hide"></iframe>
		</div>

		<div id="transformMessage" name="transformMessage" align="center"> </div>
		<table class="bigtab" border="0" cellspacing="10" width="98%">
			<tbody>
				<tr>
					<td class="optionlabel1">
						a1:
					</td>
					<td class="optiondata1">
						<input type="text" id="a1" name="a1" value="0"></input>
					</td>
					<td class="optionlabel2">
						a2:
					</td>
					<td class="optiondata2">
						<input type="text" id="a2" name="a2" value="0"></input>
					</td>
				</tr>
				<tr>
					<td class="optionlabel1">
						a3:
					</td>
					<td class="optiondata1">
						<input type="text" id="a3" name="a3" value="0"></input>
					</td>
					<td class="optionlabel2">
						a4:
					</td>
					<td class="optiondata2">
						<input type="text" id="a4" name="a4" value="0"></input>
					</td>
				</tr>
				<tr>
					<td class="optionlabel1">
						a5:
					</td>
					<td class="optiondata1">
						<input type="text" id="a5" name="a5" value="0"></input>
					</td>
					<td class="optionlabel2">
						a6:
					</td>
					<td class="optiondata2">
						<input type="text" id="a6" name="a6" value="0"></input>
					</td>
				</tr>
			</tbody>
		</table>

	</form>
	
	<!-- <div id="downloadErrorDiv" name="downloadErrorDiv"> <iframe id="downloadError" name="downloadError" class="hide"> </iframe> </div>
	<div id="renderMessage" name="renderMessage"> </div>
	
	<div id="dataContent" name="dataContent" align="left">
		Data should be rendered here.
		<iframe id="resultData" name="resultData" class="hide"></iframe>
	</div> -->


	
	<h4 class="pagehead">Developed at UC Riverside Big Data Lab</h4>
	<h5 class="pagehead">By Puloma Katiyar and Dr. Ahmed Eldawy</h5>
</html>
