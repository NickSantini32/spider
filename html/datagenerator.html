<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta name="description" content="Spatial data generator developed at UC Riverside by Puloma Katiyar under guidance of Dr. Ahmed Eldawy">
	<meta name="keywords" content="Spatial data, data generator, UCR, UC Riverside, UCR big data lab, test data, Puloma Katiyar, Ahmed Eldawy, computer science">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link rel="shortcut icon" href="sd.ico">
	<script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.3.1/build/ol.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.3.1/css/ol.css">
	<style type="text/css">
		.headcol { vertical-align: top; text-align: right; }
		.widgettab { vertical-align: top; text-align: left; }
		.bigtab { } 
		.pagehead { text-align: center; }
		.optionlabel1 { text-align: right; width: 35%; }
		.optiondata1 { width: 15%; }
		.optionlabel2 { text-align: right; width: 15%; }
		.optiondata2 { width: 35%; }
		.hide { position:absolute; top:-1px; left:-1px; width:1px; height:1px; }
		.inputError { color: red; font-size: 15px; }
		.transformfields { text-align: right; }
		#dataContent { width: 70%; height: 300px; }
	</style>

	<title>Spatial Data Generator</title>
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script>
		var fEnableObj = {
			"perc": "diagonal",
			"buf": "diagonal",
			"prob": "bit",
			"dig": "bit",
			"sran": "parcel",
			"dith": "parcel",
			"dim": "uniform"
		}
		
		function disableInputs() {
			var distType = $("#dist").val();
			if(fEnableObj.perc != distType)
				$("#per").prop("disabled", true);
			if(fEnableObj.buf != distType)
				$("#buf").prop("disabled", true);
			if(fEnableObj.prob != distType)
				$("#prob").prop("disabled", true);
			if(fEnableObj.dig != distType)
				$("#dig").prop("disabled", true);
			if(fEnableObj.sran != distType)
				$("#sran").prop("disabled", true);
			if(fEnableObj.dith != distType)
				$("#dith").prop("disabled", true);
			if(fEnableObj.dim != distType)
				$("#dim").prop("disabled", true);				
		}
		
		function updateInputs() {
			$("#dim").val(2);
			$("#dim").prop("disabled", false);	
			$("#per").prop("disabled", false);
			$("#buf").prop("disabled", false);
			$("#prob").prop("disabled", false);
			$("#dig").prop("disabled", false);
			$("#sran").prop("disabled", false);
			$("#dith").prop("disabled", false);
			disableInputs();
		}
		
		function validInputs() {
			var valid = true;
			var val = $("#card").val();
			if(val < 0 || val > 1000000000000) { // arbitrarily set max to 1 trillion
				$("#cardInputError").html("Valid val > 0 and < 1 trillion");
				valid = false;
			}
			val = $("#dim").val();
			if($("#dist").val() == "uniform") {
				if(val < 1 || val > 1000000) { // arbitrarily set max to 1 million
					$("#dimInputError").html("Valid val > 1 and < 1 million");
					valid = false;
				}
			} else {
				if(val != 2) { 
					$("#dimInputError").html("Valid val = 2");
					valid = false;
				}
			}
			val = $("#per").val();
			if(val < 0 || val > 1) {
				$("#perInputError").html("Valid val > 0 and < 1");
				valid = false;
			}
			val = $("#buf").val();
			if(val < 0 || val > 1) {
				$("#bufInputError").html("Valid val > 0 and < 1");
				valid = false;
			}
			val = $("#prob").val();
			if(val < 0 || val > 1) {
				$("#probInputError").html("Valid val > 0 and < 1");
				valid = false;
			}
			val = $("#dig").val();
			if(val < 0 || val > 100000) {
				$("#digInputError").html("Valid val >= 0 and < 100,000");
				valid = false;
			}				
			val = $("#sran").val();
			if(val < 0 || val > 1) {
				$("#sranInputError").html("Valid val > 0 and < 1");
				valid = false;
			}					
			val = $("#dith").val();
			if(val < 0 || val > 1) {
				$("#dithInputError").html("Valid val > 0 and < 1");
				valid = false;
			}
			val = $("#seed").val();
			if(val && (val < 0 || val > 100000000000000)) { // arbitrarily set max to 100 trillion
				$("#seedInputError").html("Valid val >= 0 and < 1 trillion");
				valid = false;
			}						
			return valid;
		}
		
		function resetInputError(inputId) {
			$("#" + inputId).html("");
		}
		
		function buildURL(forRender, forPlink) {
			var paramVals = {
				"card": $("#card").val(),
				"dist": $("#dist").val(),
				"dim": $("#dim").val(),
				"fmt": $("#fmt").val(),
				"geo": "point",
				"seed": $("#seed").val()
			};
			
			var inputVal = $("#per").val();
			if(!$("#per").prop("disabled") && inputVal)
				paramVals["per"] = inputVal;
			inputVal = $("#buf").val();
			if(!$("#buf").prop("disabled") && inputVal)
				paramVals["buf"] = inputVal;		
			inputVal = $("#prob").val();
			if(!$("#prob").prop("disabled") && inputVal)
				paramVals["prob"] = inputVal;		
			inputVal = $("#dig").val();
			if(!$("#dig").prop("disabled") && inputVal)
				paramVals["dig"] = inputVal;		
			inputVal = $("#sran").val();
			if(!$("#sran").prop("disabled") && inputVal)
				paramVals["sran"] = inputVal;		
			inputVal = $("#dith").val();
			if(!$("#dith").prop("disabled") && inputVal)
				paramVals["dith"] = inputVal;	

			var inputVal1 = $("#a1").val();
			var inputVal2 = $("#a2").val();
			var inputVal3 = $("#a3").val();
			var inputVal4 = $("#a4").val();
			var inputVal5 = $("#a5").val();
			var inputVal6 = $("#a6").val();
			if(!inputVal1 || !inputVal2 || !inputVal3 || !inputVal4|| !inputVal5 || !inputVal6) {
				$("#transformMessage").html("Fill all parameters for transformation.");
			} else {
				paramVals["a1"] = inputVal1;
				paramVals["a2"] = inputVal2;
				paramVals["a3"] = inputVal3;
				paramVals["a4"] = inputVal4;
				paramVals["a5"] = inputVal5;
				paramVals["a6"] = inputVal6;
			}
				
			if(forRender) {
				var message = "";
				if(paramVals["card"] > 1000) {
					paramVals["card"] = 1000;
					message += "Only up to 1000 points supported for visualization. Cardinality overridden.";
				}
				if(paramVals["dim"] > 2) {
					paramVals["dim"] = 2;
					if(message)
						message += "<br>";
					message += "Only 2D supported for visualization. Dimensions overridden.";
				}
				paramVals["fmt"] = "wkt";
				paramVals["strm"] = "browser";
				$("#renderMessage").html(message);
			} else {
				paramVals["strm"] = "cfile";
			}
			
			if(!paramVals["seed"]) {
				var d = new Date();
				paramVals["seed"] = d.getTime();
			}
			
			if(forPlink)
				var url = "http://localhost/datagenerator.html?";
			else
				var url = "http://localhost/cgi/generator.py?";
			for(var key in paramVals) {
				url += (key + "=" + encodeURIComponent(paramVals[key]) + "&");
			}						
			return url;																			
		}
		
		function submitAndDownload() {
			var downloadURL = buildURL(false, false);
			// downloadError element does double duty here to show error or pop-up file-save dialog
			document.getElementById("downloadError").src = downloadURL;
		}
		
		function submitAndRender(inputId) {
			if(inputId == "dist")
				updateInputs();
			else
				resetInputError(inputId);
			if(!validInputs())
				return;
			var dataURL = buildURL(true, false);
			var permalink = buildURL(false, true);
			$("#plink").val(permalink);

			var XHR = new XMLHttpRequest();
			XHR.addEventListener( 'load', function(event) {
				if(XHR.status != 200) {
					$("#renderMessage").html(`Error ${XHR.status}: ${XHR.statusText}`);
					return;
				}
				$("#dataContent").html("");
                var vectorLayer = new ol.layer.Vector({
                    source: new ol.source.Vector({
                        features: (new ol.format.WKT()).readFeatures(XHR.responseText)
                    })
                });
                
                var view = new ol.View({
                    center: [0.5, 0.5],
                    zoom: 25
                });
                
                var map = new ol.Map({
                    target: 'dataContent',
                    layers: [vectorLayer],
                    view: view
                });
			});
			XHR.addEventListener( 'error', function(event) {
				$("#renderMessage").html(`Error ${XHR.status}: ${XHR.statusText}`);
			});
			XHR.open( 'GET', dataURL);
			XHR.send(null);
		}
		
		function setupSubmitAndRender() {
			var curURL = new URL(window.location);
			var paramString = new URLSearchParams(curURL.searchParams);
			if(paramString != "") {
				if(paramString.has("dist"))
					$('#dist').val(paramString.get("dist"));
				if(paramString.has("card"))
					$('#card').val(paramString.get("card"));
				if(paramString.has("dim"))
					$('#dim').val(paramString.get("dim"));
				if(paramString.has("fmt"))
					$('#fmt').val(paramString.get("fmt"));
				if(paramString.has("per"))
					$('#per').val(paramString.get("per"));
				if(paramString.has("buf"))
					$('#buf').val(paramString.get("buf"));
				if(paramString.has("prob"))
					$('#prob').val(paramString.get("prob"));
				if(paramString.has("dig"))
					$('#dig').val(paramString.get("dig"));
				if(paramString.has("sran"))
					$('#sran').val(paramString.get("sran"));
				if(paramString.has("dith"))
					$('#dith').val(paramString.get("dith"));
				if(paramString.has("seed"))
					$('#seed').val(paramString.get("seed"));
				if(paramString.has("a1"))
					$('#a1').val(paramString.get("a1"));
				if(paramString.has("a2"))
					$('#a2').val(paramString.get("a2"));
				if(paramString.has("a3"))
					$('#a3').val(paramString.get("a3"));
				if(paramString.has("a4"))
					$('#a4').val(paramString.get("a4"));
				if(paramString.has("a5"))
					$('#a5').val(paramString.get("a5"));
				if(paramString.has("a6"))
					$('#a6').val(paramString.get("a6"));
			}
			submitAndRender('dist');
		}
		
	</script>

</head>

<body style="background-color:#FEFEFF;" onload="setupSubmitAndRender()">
	<h1 class="pagehead">Spatial Data Generator</h1>
	
	<form id="datareq" action="javascript:void(0);" onSubmit="submitAndDownload()">
		<table class="bigtab" border="0" cellspacing="10" width="98%">
			<tbody>
				<tr>
					<td class="optionlabel1">
						Distribution:
					</td>
					<td class="optiondata1">
						<select id="dist" name="dist" onchange="submitAndRender('dist')">
							<option value="uniform">Uniform</option>
							<option value="diagonal">Diagonal</option>
							<option value="gaussian">Gaussian</option>
							<option value="sierpinski">Sierpinski</option>
							<option value="bit">Bit</option>
							<option value="parcel">Parcel</option>
						</select>
					</td>
					<td class="optionlabel2">
						Cardinality:	
					</td>
					<td class="optiondata2">
						<input type="number" value="100" id="card" name="card" onchange="submitAndRender('cardInputError')"></input>
						<div class="inputError" id="cardInputError"></div>
					</td>
				</tr>
				
				<tr>
					<td class="optionlabel1">
						Dimension:
					</td>
					
					<td class="optiondata1">
						<input type="number" value="2" id="dim" name="dim" onchange="submitAndRender('dimInputError')"></input>
						<div class="inputError" id="dimInputError"></div>
					</td>					
					
					
					<td class="optionlabel2">
						Format:
					</td>
					<td class="optiondata2">
						<select id="fmt" name="fmt">
							<option value="wkt">wkt</option>
							<option value="csv">csv</option>
							<option value="gjson">geoJSON</option>
						</select>
					</td>
				</tr>
				
				<tr>
					<td class="optionlabel1">
						Percentage:
					</td>
					<td class="optiondata1">
						<input type="text" value="0.5" id="per" name="per" onchange="submitAndRender('perInputError')"></input>
						<div class="inputError" id="perInputError"></div>
					</td>
					<td class="optionlabel2">
						Buffer:
					</td>
					<td class="optiondata2">
						<input type="text" value="0.5" id="buf" name="buf" onchange="submitAndRender('bufInputError')"></input>
						<div class="inputError" id="bufInputError"></div>
					</td>
				</tr>
				
				<tr>
					<td class="optionlabel1">
						Probability:
					</td>
					<td class="optiondata1">
						<input type="text" value="0.5" id="prob" name="prob" onchange="submitAndRender('probInputError')"></input>
						<div class="inputError" id="probInputError"></div>
					</td>
					<td class="optionlabel2">
						Digits:
					</td>
					<td class="optiondata2">
						<input type="number" value="2" id="dig" name="dig" onchange="submitAndRender('digInputError')"></input>
						<div class="inputError" id="digInputError"></div>
					</td>
				</tr>
				
				<tr>
					<td class="optionlabel1">
						Split range:
					</td>
					<td class="optiondata1">
						<input type="text" value="0.5" id="sran" name="sran" onchange="submitAndRender('sranInputError')"></input>
						<div class="inputError" id="sranInputError"></div>
					</td>
					<td class="optionlabel2">
						Dither:
					</td>
					<td class="optiondata2">
						<input type="text" value="0.5" id="dith" name="dith" onchange="submitAndRender('dithInputError')"></input>
						<div class="inputError" id="dithInputError"></div>
					</td>
				</tr>
				
				<tr>
					<td class="optionlabel1">
						Seed value:
					</td>
					<td class="optiondata1">
						<input type="number" id="seed" name="seed" onchange="submitAndRender('seedInputError')"></input>
						<div class="inputError" id="seedInputError"></div>
					</td>
					
					<td class="optionlabel2">
						Permalink:
					</td>
					<td class="optiondata2">
						<input type="text" id="plink" name="plink" value="" readonly></input>
					</td>
				</tr>
				
				<tr>
					<td colspan="4" align="center">
						<input type="submit" value="Download"></input>
					</td>
				</tr>
				
			</tbody>
		</table>

		<div id="downloadErrorDiv" name="downloadErrorDiv"> <iframe id="downloadError" name="downloadError" class="hide"> </iframe> </div>
		<div id="renderMessage" name="renderMessage"> </div>
		
		<div id="dataContent" name="dataContent" align="left">
			Data should be rendered here.
			<iframe id="resultData" name="resultData" class="hide"></iframe>
		</div>

		<div id="transformMessage" name="transformMessage" align="center"> </div>
		<table class="bigtab" border="0" cellspacing="10" width="98%">
			<tbody>
				<tr>
					<td class="optionlabel1">
						a1:
					</td>
					<td class="optiondata1">
						<input type="text" id="a1" name="a1" value="0"></input>
					</td>
					<td class="optionlabel2">
						a2:
					</td>
					<td class="optiondata2">
						<input type="text" id="a2" name="a2" value="0"></input>
					</td>
				</tr>
				<tr>
					<td class="optionlabel1">
						a3:
					</td>
					<td class="optiondata1">
						<input type="text" id="a3" name="a3" value="0"></input>
					</td>
					<td class="optionlabel2">
						a4:
					</td>
					<td class="optiondata2">
						<input type="text" id="a4" name="a4" value="0"></input>
					</td>
				</tr>
				<tr>
					<td class="optionlabel1">
						a5:
					</td>
					<td class="optiondata1">
						<input type="text" id="a5" name="a5" value="0"></input>
					</td>
					<td class="optionlabel2">
						a6:
					</td>
					<td class="optiondata2">
						<input type="text" id="a6" name="a6" value="0"></input>
					</td>
				</tr>
			</tbody>
		</table>

	</form>
	
	<!-- <div id="downloadErrorDiv" name="downloadErrorDiv"> <iframe id="downloadError" name="downloadError" class="hide"> </iframe> </div>
	<div id="renderMessage" name="renderMessage"> </div>
	
	<div id="dataContent" name="dataContent" align="left">
		Data should be rendered here.
		<iframe id="resultData" name="resultData" class="hide"></iframe>
	</div> -->


	
	<h4 class="pagehead">Developed at UC Riverside Big Data Lab</h4>
	<h5 class="pagehead">By Puloma Katiyar and Dr. Ahmed Eldawy</h5>
</html>
