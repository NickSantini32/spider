<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta name="description" content="Spatial data generator developed at UC Riverside by Puloma Katiyar under guidance of Dr. Ahmed Eldawy">
	<meta name="keywords" content="Spatial data, data generator, UCR, UC Riverside, UCR big data lab, test data, Puloma Katiyar, Ahmed Eldawy, computer science">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link rel="shortcut icon" href="sd.ico">
	<script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.3.1/build/ol.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.3.1/css/ol.css">
	<style type="text/css">
		.headcol { vertical-align: top; text-align: right; }
		.widgettab { vertical-align: top; text-align: left; }
		.bigtab { } 
		.pagehead { text-align: center; }
		.optionlabel1 { text-align: right; width: 35%; }
		.optiondata1 { width: 15%; }
		.optionlabel2 { text-align: right; width: 15%; }
		.optiondata2 { width: 35%; }
		.hide { position:absolute; top:-1px; left:-1px; width:1px; height:1px; }
		.inputError { color: red; font-size: 15px; }
		#dataContent { width: 70%; height: 300px; }
	</style>

	<title>Spatial Data Generator</title>
	
	<script>
		var fEnableObj = {
			"perc": "diagonal",
			"buf": "diagonal",
			"prob": "bit",
			"dig": "bit",
			"sran": "parcel",
			"dith": "parcel",
			"dim": "uniform"
		}
		
		function disableInputs() {
			var distType = document.getElementById("dist").value
			if(fEnableObj.perc != distType)
				document.getElementById("per").disabled = true;
			if(fEnableObj.buf != distType)
				document.getElementById("buf").disabled = true;
			if(fEnableObj.prob != distType)
				document.getElementById("prob").disabled = true;
			if(fEnableObj.dig != distType)
				document.getElementById("dig").disabled = true;
			if(fEnableObj.sran != distType)
				document.getElementById("sran").disabled = true;
			if(fEnableObj.dith != distType)
				document.getElementById("dith").disabled = true;
			if(fEnableObj.dim != distType)
				document.getElementById("dim").disabled = true;				
		}
		
		function updateInputs() {
			document.getElementById("dim").value = 2;
			document.getElementById("dim").disabled = false;
			document.getElementById("per").disabled = false;
			document.getElementById("buf").disabled = false;
			document.getElementById("prob").disabled = false;
			document.getElementById("dig").disabled = false;
			document.getElementById("sran").disabled = false;
			document.getElementById("dith").disabled = false;	
			disableInputs();
		}
		
		function validInputs() {
			var valid = true;
			var val = document.getElementById("card").value
			if(val < 0 || val > 1000000000000) { // arbitrarily set max to 1 trillion
				document.getElementById("cardInputError").innerHTML = "Valid val > 0 and < 1 trillion";
				valid = false;
			}
			val = document.getElementById("dim").value
			if(document.getElementById("dist").value == "uniform") {
				if(val < 1 || val > 1000000) { // arbitrarily set max to 1 million
					document.getElementById("dimInputError").innerHTML = "Valid val > 1 and < 1 million";
					valid = false;
				}
			} else {
				if(val != 2) { 
					document.getElementById("dimInputError").innerHTML = "Valid val = 2";
					valid = false;
				}
			}
			val = document.getElementById("per").value
			if(val < 0 || val > 1) {
				document.getElementById("perInputError").innerHTML = "Valid val > 0 and < 1";
				valid = false;
			}
			val = document.getElementById("buf").value
			if(val < 0 || val > 1) {
				document.getElementById("bufInputError").innerHTML = "Valid val > 0 and < 1";
				valid = false;
			}
			val = document.getElementById("prob").value
			if(val < 0 || val > 1) {
				document.getElementById("probInputError").innerHTML = "Valid val > 0 and < 1";
				valid = false;
			}
			val = document.getElementById("dig").value
			if(val < 0 || val > 100000) {
				document.getElementById("digInputError").innerHTML = "Valid val >= 0 and < 100,000";
				valid = false;
			}				
			val = document.getElementById("sran").value
			if(val < 0 || val > 1) {
				document.getElementById("sranInputError").innerHTML = "Valid val > 0 and < 1";
				valid = false;
			}					
			val = document.getElementById("dith").value
			if(val < 0 || val > 1) {
				document.getElementById("dithInputError").innerHTML = "Valid val > 0 and < 1";
				valid = false;
			}
			val = document.getElementById("seed").value
			if(val && (val < 0 || val > 1000000000000)) { // arbitrarily set max to 1 trillion
				document.getElementById("seedInputError").innerHTML = "Valid val >= 0 and < 1 trillion";
				valid = false;
			}						
			
			return valid;
		}
		
		function resetInputError(inputId) {
			document.getElementById(inputId).innerHTML = "";
		}
		
		function buildURL() {
			var url = "http://localhost/cgi/generator.py?";
			url += "dist=" + encodeURIComponent(document.getElementById("dist").value);
			url += "&card=" + encodeURIComponent(document.getElementById("card").value);
			url += "&dim=" + encodeURIComponent(document.getElementById("dim").value);
			url += "&fmt=" + encodeURIComponent(document.getElementById("fmt").value);
			url += "&strm=" + encodeURIComponent(document.getElementById("strm").value);
			url += "&geo=point";
			url += "&seed=" + encodeURIComponent(document.getElementById("seed").value);
			
			var inputVal = encodeURIComponent(document.getElementById("per").value);
			if(!document.getElementById("per").disabled && inputVal)
				url += "&per=" + inputVal;
			inputVal = encodeURIComponent(document.getElementById("buf").value);
			if(!document.getElementById("buf").disabled && inputVal)
				url += "&buf=" + inputVal;
			inputVal = encodeURIComponent(document.getElementById("prob").value);
			if(!document.getElementById("prob").disabled && inputVal)
				url += "&prob=" + inputVal;
			inputVal = encodeURIComponent(document.getElementById("dig").value);
			if(!document.getElementById("dig").disabled && inputVal)
				url += "&dig=" + inputVal;
			inputVal = encodeURIComponent(document.getElementById("sran").value);
			if(!document.getElementById("sran").disabled && inputVal)
				url += "&sran=" + inputVal;
			inputVal = encodeURIComponent(document.getElementById("dith").value);
			if(!document.getElementById("dith").disabled && inputVal)
				url += "&dith=" + inputVal;	
			return url;																			
		}
		
		function submitAndRender() {
			if(!validInputs())
				return;
			formURL = buildURL();

			XHR = new XMLHttpRequest();
			XHR.addEventListener( 'load', function(event) {
				document.getElementById("dataContent").innerHTML = "";
				// document.getElementById("dataContent").innerHTML = XHR.responseText;
                var vectorLayer = new ol.layer.Vector({
                    source: new ol.source.Vector({
                        // features: (new ol.format.GeoJSON()).readFeatures(XHR.responseText)
                        features: (new ol.format.WKT()).readFeatures(XHR.responseText)
                    })
                });
                
                var view = new ol.View({
                    center: [0.5, 0.5],
                    zoom: 25
                });
                
                var map = new ol.Map({
                    target: 'dataContent',
                    layers: [vectorLayer],
                    view: view
                });
			});
			XHR.addEventListener( 'error', function(event) {
				alert( event ); // TODO: show error correctly
			});
			XHR.open( 'GET', formURL);
			XHR.send(null);

		/*
			var vectorSource = new ol.layer.GeoJSON({
        		projection: 'EPSG:3857',
        		url: formURL
      		});

            var vectorSource = new VectorSource({
                features: (new ol.format.GeoJSON()).readFeatures(XHR.responseText)
            });
      		
		*/
		}
		
	</script>

</head>

<body style="background-color:#FEFEFF;" onload="disableInputs()">
	<h1 class="pagehead">Spatial Data Generator</h1>
	
	<form id="datareq" action="javascript:void(0);" onSubmit="submitAndRender()">
		<table class="bigtab" border="0" cellspacing="10" width="98%">
			<tbody>
				<tr>
					<td class="optionlabel1">
						Distribution ?:
					</td>
					<td class="optiondata1">
						<select id="dist" name="dist" onchange="updateInputs()">
							<option value="uniform">Uniform</option>
							<option value="diagonal">Diagonal</option>
							<option value="gaussian">Gaussian</option>
							<option value="sierpinski">Sierpinski</option>
							<option value="bit">Bit</option>
							<option value="parcel">Parcel</option>
						</select>
					</td>
					<td class="optionlabel2">
						Cardinality ?:	
					</td>
					<td class="optiondata2">
						<input type="number" value="100" id="card" name="card" onchange="resetInputError('cardInputError')"></input>
						<div class="inputError" id="cardInputError"></div>
					</td>
				</tr>
				
				<tr>
					<td class="optionlabel1">
						Dimension ?:
					</td>
					
					<td class="optiondata1">
						<input type="number" value="2" id="dim" name="dim" onchange="resetInputError('dimInputError')"></input>
						<div class="inputError" id="dimInputError"></div>
					</td>					
					
					
					<td class="optionlabel2">
						Format ?:
					</td>
					<td class="optiondata2">
						<select id="fmt" name="fmt">
							<option value="wkt">wkt</option>
							<option value="csv">csv</option>
							<option value="gjson">geoJSON</option>
						</select>
					</td>
				</tr>
				
				<tr>
					<td class="optionlabel1">
						Percentage ?:
					</td>
					<td class="optiondata1">
						<input type="text" value="0.5" id="per" name="per" onchange="resetInputError('perInputError')"></input>
						<div class="inputError" id="perInputError"></div>
					</td>
					<td class="optionlabel2">
						Buffer ?:
					</td>
					<td class="optiondata2">
						<input type="text" value="0.5" id="buf" name="buf" onchange="resetInputError('bufInputError')"></input>
						<div class="inputError" id="bufInputError"></div>
					</td>
				</tr>
				
				<tr>
					<td class="optionlabel1">
						Probability ?:
					</td>
					<td class="optiondata1">
						<input type="text" value="0.5" id="prob" name="prob" onchange="resetInputError('probInputError')"></input>
						<div class="inputError" id="probInputError"></div>
					</td>
					<td class="optionlabel2">
						Digits ?:
					</td>
					<td class="optiondata2">
						<input type="number" value="2" id="dig" name="dig" onchange="resetInputError('digInputError')"></input>
						<div class="inputError" id="digInputError"></div>
					</td>
				</tr>
				
				<tr>
					<td class="optionlabel1">
						Split range ?:
					</td>
					<td class="optiondata1">
						<input type="text" value="0.5" id="sran" name="sran" onchange="resetInputError('sranInputError')"></input>
						<div class="inputError" id="sranInputError"></div>
					</td>
					<td class="optionlabel2">
						Dither ?:
					</td>
					<td class="optiondata2">
						<input type="text" value="0.5" id="dith" name="dith" onchange="resetInputError('dithInputError')"></input>
						<div class="inputError" id="dithInputError"></div>
					</td>
				</tr>
				
				<tr>
					<td class="optionlabel1">
						Seed value ?:
					</td>
					<td class="optiondata1">
						<input type="number" id="seed" name="seed" onchange="resetInputError('seedInputError')"></input>
						<div class="inputError" id="seedInputError"></div>
					</td>
					<td class="optionlabel2">
						Data destination ?:
					</td>
					<td class="optiondata2">
						<select id="strm" name="strm">
							<option value="browser">Browser</option>
							<option value="cfile">File</option>
						</select>						
					</td>					
				</tr>
				
				<tr>
					<td colspan="4" align="center">
						<input type="submit" value="Generate"></input>
					</td>
				</tr>
			</tbody>
		</table>
	</form>
	
	<div id="dataContent" name="dataContent" align="center">
		Data will be here
		<iframe id="resultData" name="resultData" class="hide"></iframe>
	</div>
	
	<h4 class="pagehead">Developed at UC Riverside Big Data Lab</h4>
	<h5 class="pagehead">By Puloma Katiyar and Dr. Ahmed Eldawy</h5>
</html>
